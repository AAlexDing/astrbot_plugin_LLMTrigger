# LLM定时触发插件

一个专门为AstrBot设计的LLM定时触发插件，支持定时向指定用户/群组发送消息并触发LLM回复。

## 🚀 功能特性

- **CRON定时调度**: 支持标准CRON表达式，灵活设置多个触发时间
- **多平台支持**: 支持AstrBot的所有消息平台（QQ、微信、Telegram等）
- **LLM提供商选择**: 可为不同用户/群组配置不同的LLM提供商
- **群组/私聊支持**: 同时支持群组和私聊消息触发
- **消息内容定制**: 每个触发器可配置独立的触发消息内容
- **管理员通知**: 支持执行成功/失败时向管理员发送通知

## 📋 配置说明

### 基本配置参数

- **调度器检查间隔**: 调度器检查任务的时间间隔（秒）
- **群组LLM触发配置**: 配置群组消息的定时触发
- **私聊LLM触发配置**: 配置私聊消息的定时触发  
- **CRON表达式**: 定时触发的时间配置
- **管理员用户ID**: 接收通知的管理员ID
- **通知设置**: 成功/失败时是否发送通知

### 配置格式

#### 群组触发配置格式
```
消息平台名::群id::LLM提供商名::CRON表达式::定时消息内容
```

示例：
```
aiocqhttp::123456789::openai::0 9 * * *::早上好，今天天气如何？
gewechat::987654321@chatroom::claude::0 18 * * *::今天有什么新闻吗？
```

#### 私聊触发配置格式  
```
消息平台名::用户id::LLM提供商名::CRON表达式::定时消息内容
```

示例：
```
aiocqhttp::987654321::openai::0 18 * * *::今天的学习计划是什么？
gewechat::wxid_45526124::gemini::0 12 * * *::帮我总结一下今天的工作
```

### CRON表达式说明

格式：`分 时 日 月 周`

常用示例：
- `0 9 * * *` - 每天上午9点
- `0 18 * * *` - 每天下午6点
- `*/30 * * * *` - 每30分钟
- `0 0 1 * *` - 每月1日午夜
- `0 8 * * 1-5` - 工作日上午8点

| 字段 | 范围 | 特殊字符 |
|------|------|----------|
| 分钟 | 0-59 | * , - / |
| 小时 | 0-23 | * , - / |
| 日期 | 1-31 | * , - / |
| 月份 | 1-12 | * , - / |
| 星期 | 0-6  | * , - / |

## 📖 使用示例

### 示例1：每日早安群组消息
```json
{
  "scheduler_check_interval": 30,
  "platform_group_provider_map": [
    "aiocqhttp::123456789::openai::0 9 * * *::早上好大家！今天天气怎么样？",
    "gewechat::987654321@chatroom::claude::0 9 * * *::新的一天开始了，有什么计划吗？"
  ],
  "notification_on_success": false,
  "notification_on_failure": true
}
```

### 示例2：工作日提醒 + 周末放松
```json
{
  "scheduler_check_interval": 30,
  "platform_group_provider_map": [
    "aiocqhttp::work_group::openai::0 9 * * 1-5::今天的工作重点是什么？",
    "aiocqhttp::friends_group::claude::0 10 * * 6,0::周末愉快！有什么好的电影推荐吗？"
  ],
  "platform_friend_provider_map": [
    "aiocqhttp::boss_id::gemini::0 8 * * 1-5::请帮我制定今天的工作计划"
  ]
}
```

### 示例3：多时段提醒
```json
{
  "scheduler_check_interval": 30,
  "platform_group_provider_map": [
    "aiocqhttp::study_group::openai::0 9 * * *::早上好！今天的学习目标是什么？",
    "aiocqhttp::study_group::openai::0 12 * * *::中午了，休息一下，下午要学什么？",
    "aiocqhttp::study_group::openai::0 19 * * *::晚上好！今天学习了什么新知识？"
  ]
}
```

## 🎯 使用场景

1. **日常问候**: 定时发送早安、晚安消息，让LLM回复个性化问候
2. **学习提醒**: 定时询问学习进度，获取学习建议和计划
3. **工作助手**: 定时询问工作安排，获取任务提醒和建议
4. **天气查询**: 定时询问天气情况，获取天气预报和穿衣建议
5. **新闻总结**: 定时询问今日新闻，获取新闻摘要和分析
6. **健康提醒**: 定时询问健康状况，获取运动和饮食建议
7. **心理关怀**: 定时进行情感交流，获取心理支持和建议

## 📋 管理命令

- `/llm_trigger` - 查看插件状态和统计信息
- `/llm_trigger_test` - 测试所有触发器（仅管理员）

## 🔧 故障排除

### 常见问题

1. **触发器不执行**
   - 检查CRON表达式格式是否正确
   - 确认插件已启用
   - 查看调度器检查间隔设置

2. **LLM没有回复**
   - 检查LLM提供商名称是否正确
   - 确认提供商配置是否正常
   - 查看AstrBot日志中的错误信息

3. **消息发送失败**
   - 检查平台名称是否正确
   - 确认群组/用户ID是否有效
   - 检查机器人是否有发送权限

4. **配置解析错误**
   - 检查配置格式是否使用`::`分隔符  
   - 确认配置格式为：`平台名::ID::提供商::CRON表达式::消息内容`
   - 验证CRON表达式格式是否正确
   - 确认消息内容中的`::`会被正确处理
   - 验证所有必要字段都已填写

### 调试建议

1. 使用`/llm_trigger_test`命令测试配置
2. 查看AstrBot的详细日志输出
3. 先从简单的配置开始测试
4. 确保机器人在目标群组/用户中有必要权限

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个插件！